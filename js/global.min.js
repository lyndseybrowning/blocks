/*!
 * 
 * 
 * @author(s) Lyndsey Browning
 * @version 0.0.1
 * Copyright .  licensed.
 */
var game=function(){function a(a,b,d,e,f){var g;if(!window.$)throw new Error("jQuery not found! Please add.");if("undefined"==typeof a||""===a)throw new Error("No URL passed to callAjax() function.");if(b=b.toLowerCase()||"html","html"===b){if(g=document.querySelector(e),null===g)throw new Error("callAjax() returnType specified as HTML but no DOM element provided for return data");var h=c("img",{className:"ajax-loading",src:"/img/ajax-loading.gif"});g.innerHTML="",g.appendChild(h)}$.ajax({cache:!1,method:"html"===b?"GET":"POST",url:a,data:d,success:function(a){return"html"===b&&(g.innerHTML=a),"json"===b?a=JSON.parse(a):void 0},complete:function(a){"function"==typeof f?f(a.responseText):"[object Array]"===Object.prototype.toString.call(f)&&f.forEach(function(b){b(a.responseText)})}})}function b(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function c(a,b){if(""===a)throw new Error("No element passed to generateEl() function.");var c,d=document.createElement(a),e=!1;for(var f in b)e="_"===f[0]?!0:!1,e?(c=f.substring(1),d.style[c]=b[f]):d[f]=b[f];return d}function d(a){if("number"!=typeof a)throw new Error("game.init() expects Number as first parameter. Non-numeric value given.");if(a>W.maxTimer)throw new Error("maxTimer value exceeded. game.init() expects a timer value up to "+W.maxTimer+" seconds");return a>=W.minTimer&&(W.timer=a,G=a),a}function e(){var a=document.getElementById("js-timer");return a.innerHTML=W.timer,a}function f(){var a=c("div",{id:"js-countdown",className:"fade"});return N.appendChild(a),a}function g(a){var b,c,d,e=document.querySelector("body").getBoundingClientRect().bottom,g=P.getBoundingClientRect(),i=e-g.top,j=3;U=0,P.innerHTML="",P.style.height=i-10+"px",c=f(),b=v(P),K=b.elwidth,L=b.elheight;var k=function(){0===j&&(clearInterval(d),h(),a()),c.innerHTML=0===j?"GO!":j--};d=setInterval(k.bind(j,a),W.timerSpeed)}function h(){var a=document.getElementById("js-countdown");a.className+=" fade-out",setTimeout(function(){a.parentNode.removeChild(a)},1e3)}function i(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function j(a){return V=a===W.colors.length-1?0:V+1,W.colors[a]}function k(){var a=W.blockSize,b=P.offsetWidth-a,d=P.offsetHeight-a,e=c("div",{className:"block",_width:a+"px",_height:a+"px",_position:"absolute",_left:i(0,b)+"px",_top:i(0,d)+"px",_backgroundColor:j(V)});return e}function l(){H=m(),I=H+W.timer,J=setInterval(n,100),n(),p()}function m(){return Math.floor(Date.now()/1e3)}function n(){var a=m(),b=a-H;O.innerHTML=W.timer-b,o(a)&&(clearInterval(J),w())}function o(a){return a=a||m(),a===I}function p(){var a=k(),b=function(){o()&&w(),Q.innerHTML=++U,this.parentNode.removeChild(this),this.removeEventListener(T,b),p()};P.appendChild(a),a.addEventListener(T,b)}function q(){var b=document.getElementById("btnSubmit"),c=document.getElementById("frmScoreSubmit"),d=document.getElementById("playerName"),e=document.getElementById("uid"),f=function(b){var c=document.querySelector(".honeypot"),f={};d.className=""===d.value?"empty":"",""!==d.value&&(f.playerName=d.value,f.score=U,f.screenWidth=screen.width,f.screenHeight=screen.height,f.honeypot=c.value,f.uid=e.value,A("playerName",d.value),a("/ajax/submit-score.php","null",f,"#add-score",r)),b.preventDefault()};F=B("playerName"),d.value=""!==F?F:"",b.addEventListener(T,f),c.addEventListener("submit",f),s(E,"Don't submit score, play again now!")}function r(a){var b,d=JSON.parse(a).success;d?(E.innerHTML="<p> Thank you! Your score has been submitted! </p>",b=c("a",{href:"/leaderboard.html",className:"button button--blue",innerHTML:"View Leaderboard"}),E.appendChild(b),E.innerHTML+=" or... ",s(E)):E.innerHTML+="<p> Sorry! Looks like there was an error submitting your score. Please try again! </p>"}function s(a,b){var c=t(b);a.appendChild(c),u(c)}function t(a){var b=c("button",{id:"js-new-game",className:"button button--blue",innerHTML:"undefined"!=typeof a?a:"Play Again"});return b}function u(a){a.addEventListener(T,x.bind(this,G))}function v(a){return{elwidth:a.offsetWidth,elheight:a.offsetHeight}}function w(){var b=v(P);return D=document.createElement("div"),E=document.createElement("div"),D.id="game-over",D.innerHTML="Game Over! <br /> You scored "+U+" Points!",P.innerHTML="",P.appendChild(D),E.id="add-score",D.appendChild(E),b.elwidth!==K||b.elheight!==L?(D.innerHTML+='<p style="color: #FC5B2A;"> Woops! Cannot submit your score. You are attempting to manipulate the game area and this is forbidden! Please try again and play fair... </p>',!1):void a("/ajax/submit-score-form.html","html","","#add-score",q)}function x(a){U=0,d(a),e(),g(l)}function y(){a("/ajax/get-uid.php","null","","",z)}function z(a){var b=c("input",{type:"hidden",id:"uid",value:a});document.body.appendChild(b),N&&x(10)}function A(a,b,c){var d,e=new Date;c=c||1,e.setTime(e.getTime()+24*c*60*60*1e3),d="expires="+e.toGMTString(),document.cookie=a+"="+b+"; "+d+"; path=/"}function B(a){var b,c=a+"=",d=document.cookie.split(";"),e=d.length,f=0;for(f;e>f;f++)if(b=d[f].trim(),0===b.indexOf(c))return b.substring(c.length,b.length);return""}function C(b){var c=B("gameLeaderFilters");b?A("gameLeaderFilters",S.value):""!==c&&(S.value=c),a("/ajax/get-leaderboard.php","html",{deviceType:S.value},"#js-leaderboard")}var D,E,F,G,H,I,J,K,L,M=!1,N=document.getElementById("js-game"),O=(document.getElementById("js-game__top"),document.getElementById("js-timer")),P=document.getElementById("js-game__container"),Q=document.getElementById("js-score"),R=document.getElementById("js-leaderboard"),S=document.getElementById("js-filter-device"),T=b()?"touchstart":"click",U=0,V=0,W={timer:30,minTimer:10,maxTimer:180,blockSize:50,timerSpeed:M?500:1e3,colors:["#0CCE6B","#FC5B2A","#0A2E36"]};N&&y(),R&&(C(),S.addEventListener("change",C.bind(this,!0)))}();